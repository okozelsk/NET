<?xml version="1.0" encoding="UTF-8"?>
<demo dataFolder=".\\Data">

  <!--
    This demo case demonstrates classical setup of LSM (spiking) reservoir.
    One additional internal input field "aug_input" (following random signal) is used.
    QRD linear regression is used as a classifier on readout layer.
    The dataset is from https://archive.ics.uci.edu/ml/datasets/Libras+Movement and contains 15 classes of 24 instances each, where
    each class references to a hand movement type in LIBRAS. The hand movement is represented as a bidimensional curve performed
    by the hand in a period of time. The curves were obtained from videos of hand movements, with the Libras performance from 4 
    different people, during 2 sessions. Each video corresponds to only one hand movement and has about 7 seconds.    
    Each video corresponds to a function F in a functions space which is the continual version of the input dataset.
    In the video pre-processing, a time normalization is carried out selecting 45 frames from each video, in according 
    to an uniform distribution. In each frame, the centroid pixels of the segmented objects (the hand) are found, which 
    compose the discrete version of the curve F with 45 points. All curves are normalized in the unitary space.
    Each curve F is mapped in a representation with 90 features, with representing the coordinates of movement.
    Each instance represents 45 points on a bi-dimensional space, which can be plotted in an ordered way (from 1 through
    45 as the X co-ordinate) in order to draw the path of the movement.
  -->
  <case name="Classification task Libras Movement: Classical LSM reservoir, Elastic regression classifier">
    <samples fileName="LibrasMovement.csv"/>
    <stateMachineCfg randomizerSeek="0">
      <neuralPreprocessor>
        <input>
          <feedingPatterned/>
          <external>
            <field name="coord_abcissa"/>
            <field name="coord_ordinate"/>
          </external>
        </input>
        <reservoirCfgContainer>
          <reservoirCfg name="MainCfg" synapticDelayMethod="Random" maxInputDelay="0" spectralRadius="0.999">
            <pools>
              <pool name="LSM pool" dimX="6" dimY="6" dimZ="6" readoutNeuronsDensity="1">
                <neuronGroups>
                  <neuronGroup name="Exc-grp" role="Excitatory" relShare="4" augmentedStates="true">
                    <activationLeakyIF refractoryPeriods="0"/>
                    <bias min="0" max="0" randomSign="false" distribution="Uniform"/>
                  </neuronGroup>
                  <neuronGroup name="Inh-grp" role="Inhibitory" relShare="1" augmentedStates="true">
                    <activationLeakyIF refractoryPeriods="0"/>
                    <bias min="0" max="0" randomSign="false" distribution="Uniform"/>
                  </neuronGroup>
                </neuronGroups>
                <interconnection density="0.1" relShareEE="0.3" relShareEI="0.2" relShareIE="0.4" relShareII="0.1" avgDistance="NA" allowSelfConnection="false" constantNumOfConnections="false">
                  <synapse/>
                </interconnection>
              </pool>
            </pools>
          </reservoirCfg>
        </reservoirCfgContainer>
        <reservoirInstanceContainer>
          <reservoirInstance name="Main" cfg="MainCfg" augmentedStates="false">
            <inputConnections>
              <inputConnection fieldName="coord_abcissa" poolName="LSM pool" density="0.25">
                <synapse/>
              </inputConnection>
              <inputConnection fieldName="coord_ordinate" poolName="LSM pool" density="0.25">
                <synapse/>
              </inputConnection>
            </inputConnections>
          </reservoirInstance>
        </reservoirInstanceContainer>
      </neuralPreprocessor>
      <readoutLayer testDataRatio="0.0825" folds="Auto">
        <readoutUnit name="curved swing" task="Classification">
          <pp gates="3" resolution="2">
            <pDeltaRuleTrainer attempts="10" attemptEpochs="600"/>
          </pp>
        </readoutUnit>
        <readoutUnit name="horizontal swing" task="Classification">
          <ff>
            <activationIdentity/>
            <qrdRegrTrainer attempts="3" attemptEpochs="1000" noiseZeroMargin="0">
              <maxNoise min="0" max="0.5" steps="100"/>
            </qrdRegrTrainer>
          </ff>
        </readoutUnit>
        <readoutUnit name="vertical swing" task="Classification">
          <pp gates="3" resolution="2">
            <pDeltaRuleTrainer attempts="10" attemptEpochs="600"/>
          </pp>
        </readoutUnit>
        <readoutUnit name="anti-clockwise arc" task="Classification">
          <pp gates="3" resolution="2">
            <pDeltaRuleTrainer attempts="10" attemptEpochs="600"/>
          </pp>
        </readoutUnit>
        <readoutUnit name="clockwise arc" task="Classification">
          <pp gates="3" resolution="2">
            <pDeltaRuleTrainer attempts="10" attemptEpochs="600"/>
          </pp>
        </readoutUnit>
        <readoutUnit name="circle" task="Classification">
          <pp gates="3" resolution="2">
            <pDeltaRuleTrainer attempts="10" attemptEpochs="600"/>
          </pp>
        </readoutUnit>
        <readoutUnit name="horizontal straight-line" task="Classification">
          <pp gates="3" resolution="2">
            <pDeltaRuleTrainer attempts="10" attemptEpochs="600"/>
          </pp>
        </readoutUnit>
        <readoutUnit name="vertical straight-line" task="Classification">
          <pp gates="3" resolution="2">
            <pDeltaRuleTrainer attempts="10" attemptEpochs="600"/>
          </pp>
        </readoutUnit>
        <readoutUnit name="horizontal zigzag" task="Classification">
          <pp gates="3" resolution="2">
            <pDeltaRuleTrainer attempts="10" attemptEpochs="600"/>
          </pp>
        </readoutUnit>
        <readoutUnit name="vertical zigzag" task="Classification">
          <pp gates="3" resolution="2">
            <pDeltaRuleTrainer attempts="10" attemptEpochs="600"/>
          </pp>
        </readoutUnit>
        <readoutUnit name="horizontal wavy" task="Classification">
          <pp gates="3" resolution="2">
            <pDeltaRuleTrainer attempts="10" attemptEpochs="600"/>
          </pp>
        </readoutUnit>
        <readoutUnit name="vertical wavy" task="Classification">
          <pp gates="3" resolution="2">
            <pDeltaRuleTrainer attempts="10" attemptEpochs="600"/>
          </pp>
        </readoutUnit>
        <readoutUnit name="face-up curve" task="Classification">
          <pp gates="3" resolution="2">
            <pDeltaRuleTrainer attempts="10" attemptEpochs="600"/>
          </pp>
        </readoutUnit>
        <readoutUnit name="face-down curve" task="Classification">
          <pp gates="3" resolution="2">
            <pDeltaRuleTrainer attempts="10" attemptEpochs="600"/>
          </pp>
        </readoutUnit>
        <readoutUnit name="tremble" task="Classification">
          <pp gates="3" resolution="2">
            <pDeltaRuleTrainer attempts="10" attemptEpochs="600"/>
          </pp>
        </readoutUnit>
      </readoutLayer>
    </stateMachineCfg>
  </case>


  <!--
    This demo case demonstrates the simple form of ESN reservoir setup. Reservoir consists of one pool of 7x7x7=343 TanH analog neurons.
    QRD regression is used as forecasting readout.
    Time series contains real share prices of TTOO title from https://finance.yahoo.com/quote/TTOO/history?p=TTOO.
    The last recorded prices are from 2018/03/02 so network is predicting next High and Low prices for the following
    business day 2018/03/05 (where real prices were High=6.58$ and Low=5.99$).
  -->
  <case name="Forecast task High and Low share prices of TTOO (T2 Biosystems, Inc.): Small analog reservoir (ESN), QRD regression readout">
    <samples fileName="TTOO.csv"/>
    <stateMachineCfg randomizerSeek="0">
      <neuralPreprocessor>
        <input>
          <feedingContinuous bootCycles="Auto" routeToReadout="true"/>
          <external>
            <field name="High" AllowRoutingToReadout="true"/>
            <field name="Low" AllowRoutingToReadout="true"/>
            <field name="Adj Close" AllowRoutingToReadout="true"/>
          </external>
        </input>
        <reservoirCfgContainer>
          <reservoirCfg name="MainCfg" synapticDelayMethod="Random" maxInputDelay="0" spectralRadius="0.999">
            <pools>
              <pool name="Logistic pool" dimX="6" dimY="6" dimZ="6" readoutNeuronsDensity="1">
                <neuronGroups>
                  <neuronGroup name="Exc-Logistic" role="Excitatory" relShare="1" augmentedStates="true">
                    <activationTanH/>
                    <bias min="0" max="0" randomSign="false" distribution="Uniform"/>
                  </neuronGroup>
                  <neuronGroup name="Inh-Logistic" role="Inhibitory" relShare="1" augmentedStates="true">
                    <activationTanH/>
                    <bias min="0" max="0" randomSign="false" distribution="Uniform"/>
                  </neuronGroup>
                </neuronGroups>
                <interconnection density="0.1" relShareEE="0.25" relShareEI="0.25" relShareIE="0.25" relShareII="0.25" avgDistance="NA" allowSelfConnection="true" constantNumOfConnections="false">
                  <synapse/>
                </interconnection>
                <retainmentNeurons density="1">
                  <rate min="0" max="0.75" distribution="Uniform"/>
                </retainmentNeurons>
              </pool>
            </pools>
          </reservoirCfg>
        </reservoirCfgContainer>
        <reservoirInstanceContainer>
          <reservoirInstance name="Main" cfg="MainCfg" augmentedStates="false">
            <inputConnections>
              <inputConnection fieldName="High" poolName="Logistic pool" density="1">
                <synapse>
                  <analogTarget>
                    <weight min="0" max="0.05" distribution="Uniform"/>
                  </analogTarget>
                </synapse>
              </inputConnection>
              <inputConnection fieldName="Low" poolName="Logistic pool" density="1">
                <synapse>
                  <analogTarget>
                    <weight min="0" max="0.05" distribution="Uniform"/>
                  </analogTarget>
                </synapse>
              </inputConnection>
              <inputConnection fieldName="Adj Close" poolName="Logistic pool" density="1">
                <synapse>
                  <analogTarget>
                    <weight min="0" max="0.05" distribution="Uniform"/>
                  </analogTarget>
                </synapse>
              </inputConnection>
            </inputConnections>
          </reservoirInstance>
        </reservoirInstanceContainer>
      </neuralPreprocessor>
      <readoutLayer testDataRatio="0.1" folds="Auto">
        <readoutUnit name="High" task="Forecast">
          <ff>
            <activationIdentity/>
            <elasticLinRegrTrainer attemptEpochs="300" lambda="1e-6" alpha="0.5"/>
          </ff>
        </readoutUnit>
        <readoutUnit name="Low" task="Forecast">
          <ff>
            <activationIdentity/>
            <elasticLinRegrTrainer attemptEpochs="300" lambda="1e-6" alpha="0.5"/>
          </ff>
        </readoutUnit>
        <readoutUnit name="Adj Close" task="Forecast">
          <ff>
            <activationIdentity/>
            <elasticLinRegrTrainer attemptEpochs="300" lambda="1e-6" alpha="0.5"/>
          </ff>
        </readoutUnit>
      </readoutLayer>
    </stateMachineCfg>
  </case>




  <!--
    This demo case demonstrates how to instantiate two independent reservoirs. Configuration definies ESN reservoir
    structure having one pool of 512 TanH analog neurons and two instances of the reservoir (hence in total 2x512=1024 analog neurons).
    QRD regression is used as predicting readout.
    Dataset contains Mackey Glass chaotic time series (tau=17) and network forecasts the next value.
  -->
  <case name="Forecast task Mackey Glass chaotic time series: Two analog reservoirs (ESN), QRD regression output">
    <samples fileName="MackeyGlass.csv"/>
    <stateMachineCfg randomizerSeek="0">
      <neuralPreprocessor>
        <input>
          <feedingContinuous bootCycles="Auto" routeToReadout="false"/>
          <external>
            <field name="Value" AllowRoutingToReadout="true"/>
          </external>
        </input>
        <reservoirCfgContainer>
          <reservoirCfg name="ESNCfg" synapticDelayMethod="Random" maxInputDelay="0" spectralRadius="0.65">
            <pools>
              <pool name="Logistic pool" dimX="8" dimY="8" dimZ="8" readoutNeuronsDensity="1">
                <neuronGroups>
                  <neuronGroup name="Exc-Logistic" role="Excitatory" relShare="1" augmentedStates="true">
                    <activationTanH/>
                    <bias min="-0.75" max="0.75" randomSign="false" distribution="Uniform"/>
                  </neuronGroup>
                  <neuronGroup name="Inh-Logistic" role="Inhibitory" relShare="1" augmentedStates="true">
                    <activationTanH/>
                    <bias min="-0.75" max="0.75" randomSign="false" distribution="Uniform"/>
                  </neuronGroup>
                </neuronGroups>
                <interconnection density="0.1" relShareEE="0.25" relShareEI="0.25" relShareIE="0.25" relShareII="0.25" avgDistance="NA" allowSelfConnection="true" constantNumOfConnections="false">
                  <synapse/>
                </interconnection>
                <retainmentNeurons density="1">
                  <rate min="0.25" max="0.5" distribution="Uniform"/>
                </retainmentNeurons>
              </pool>
            </pools>
          </reservoirCfg>
        </reservoirCfgContainer>
        <reservoirInstanceContainer>
          <reservoirInstance name="ESN reservoir #1" cfg="ESNCfg" augmentedStates="false">
            <inputConnections>
              <inputConnection fieldName="Value" poolName="Logistic pool" density="0.5">
                <synapse/>
              </inputConnection>
            </inputConnections>
          </reservoirInstance>
          <reservoirInstance name="ESN reservoir #2" cfg="ESNCfg" augmentedStates="false">
            <inputConnections>
              <inputConnection fieldName="Value" poolName="Logistic pool" density="0.5">
                <synapse/>
              </inputConnection>
            </inputConnections>
          </reservoirInstance>
        </reservoirInstanceContainer>
      </neuralPreprocessor>
      <readoutLayer testDataRatio="0.1" folds="1">
        <readoutUnit name="Value" task="Forecast">
          <ff>
            <activationIdentity/>
            <qrdRegrTrainer attempts="1" attemptEpochs="1">
              <maxNoise min="0" max="0" steps="3"/>
            </qrdRegrTrainer>
          </ff>
        </readoutUnit>
      </readoutLayer>
    </stateMachineCfg>
  </case>

  <!--
    This demo case demonstrates performance on big reservoir. Configuration definies ESN reservoir
    structure having one pool of 3162 TanH analog neurons having 1 million synapses.
    QRD regression is used as predicting readout.
    Dataset contains Mackey Glass chaotic time series (tau=17) and network forecasts the next value.
  -->
  <case name="Forecast task Mackey Glass chaotic time series: Big analog reservoir (ESN), QRD regression output">
    <samples fileName="MackeyGlass_big.csv"/>
    <stateMachineCfg randomizerSeek="0">
      <neuralPreprocessor>
        <input>
          <feedingContinuous bootCycles="Auto" routeToReadout="false"/>
          <external>
            <field name="Value" AllowRoutingToReadout="true"/>
          </external>
        </input>
        <reservoirCfgContainer>
          <reservoirCfg name="ESNCfg" synapticDelayMethod="Random" maxInputDelay="0" spectralRadius="0.999">
            <pools>
              <pool name="Logistic pool" dimX="3162" dimY="1" dimZ="1" readoutNeuronsDensity="1">
                <neuronGroups>
                  <neuronGroup name="Exc-Logistic" role="Excitatory" relShare="1" augmentedStates="true">
                    <activationTanH/>
                    <bias min="-0.75" max="0.75" randomSign="false" distribution="Uniform"/>
                  </neuronGroup>
                  <neuronGroup name="Inh-Logistic" role="Inhibitory" relShare="1" augmentedStates="true">
                    <activationTanH/>
                    <bias min="-0.75" max="0.75" randomSign="false" distribution="Uniform"/>
                  </neuronGroup>
                </neuronGroups>
                <interconnection density="0.1" relShareEE="0.25" relShareEI="0.25" relShareIE="0.25" relShareII="0.25" avgDistance="NA" allowSelfConnection="true" constantNumOfConnections="false">
                  <synapse/>
                </interconnection>
                <retainmentNeurons density="1">
                  <rate min="0.25" max="0.5" distribution="Uniform"/>
                </retainmentNeurons>
              </pool>
            </pools>
          </reservoirCfg>
        </reservoirCfgContainer>
        <reservoirInstanceContainer>
          <reservoirInstance name="ESN reservoir" cfg="ESNCfg" augmentedStates="false">
            <inputConnections>
              <inputConnection fieldName="Value" poolName="Logistic pool" density="0.5">
                <synapse/>
              </inputConnection>
            </inputConnections>
          </reservoirInstance>
        </reservoirInstanceContainer>
      </neuralPreprocessor>
      <readoutLayer testDataRatio="0.1" folds="1">
        <readoutUnit name="Value" task="Forecast">
          <ff>
            <activationIdentity/>
            <ridgeRegrTrainer attemptEpochs="1">
              <lambda min="0" max="0" steps="10"/>
            </ridgeRegrTrainer>
          </ff>
        </readoutUnit>
      </readoutLayer>
    </stateMachineCfg>
  </case>



  <!--
    This demo case demonstrates a richer form of reservoir setup. Reservoir consists of one pool of IzhikewichIF spiking neurons
    and one pool of Sigmoid analog neurons. Pools overlap within the reservoir (share the same 3D space) and pools are
    bidirectionally interconnected.  One additional internal input field "mg" (following Mackey-Glass signal) is used.
    Feed Forward network having one hidden layer of 20 TanH neurons and TanH output neuron is used as a classifier readout unit on readout layer.
    Used dataset is a pre-processed and re-structured/reshaped version of a very commonly used dataset featuring epileptic seizure detection.
    The dataset was converted from https://archive.ics.uci.edu/ml/datasets/Epileptic+Seizure+Recognition and contains 11500 EEG recordings
    each for 1 second. After conversion there are only 2 classes, where each EEG pattern corresponds to an epileptic seizure or normal brain activity.
    Relevant paper: http://users.fs.cvut.cz/ivo.bukovsky/PROJEKT/Data/Realna/BIO/EEG/reference/PRE61907.pdf
  -->
  <case name="Classification task Recognition of the Epileptic Seizure Brain EEG Activity:  Mixed spiking and analog reservoir, Feed forward network with hidden layer as a classifier">
    <samples fileName="EpilepticSeizureActivity.csv"/>
    <stateMachineCfg randomizerSeek="0">
      <neuralPreprocessor>
        <input>
          <feedingPatterned/>
          <external>
            <field name="EEG"/>
          </external>
          <internal>
            <field name="mg">
              <mackeyGlassGenerator tau="18" b="0.1" c="-0.2"/>
            </field>
          </internal>
        </input>
        <reservoirCfgContainer>
          <reservoirCfg name="MainCfg" synapticDelayMethod="Random" maxInputDelay="0" spectralRadius="0.999">
            <inputEntryPoint x="0" y="0" z="0"/>
            <pools>
              <pool name="Spiking pool" x="0" y="0" z="0" dimX="6" dimY="6" dimZ="6" readoutNeuronsDensity="1">
                <neuronGroups>
                  <neuronGroup name="Exc-IzhikewichIF" role="Excitatory" relShare="4" augmentedStates="true">
                    <activationAutoIzhikevichIF role="Excitatory" refractoryPeriods="0" solverMethod="Euler" solverCompSteps="2"/>
                    <bias min="0" max="0" randomSign="false" distribution="Uniform"/>
                  </neuronGroup>
                  <neuronGroup name="Inh-IzhikewichIF" role="Inhibitory" relShare="1" augmentedStates="true">
                    <activationAutoIzhikevichIF role="Inhibitory" refractoryPeriods="0" solverMethod="Euler" solverCompSteps="2"/>
                    <bias min="0" max="0" randomSign="false" distribution="Uniform"/>
                  </neuronGroup>
                </neuronGroups>
                <interconnection density="0.1" relShareEE="0.3" relShareEI="0.2" relShareIE="0.4" relShareII="0.1" avgDistance="NA" allowSelfConnection="false" constantNumOfConnections="false">
                  <synapse/>
                </interconnection>
              </pool>
              <pool name="Logistic pool" x="0" y="0" z="0" dimX="4" dimY="4" dimZ="4" readoutNeuronsDensity="1">
                <neuronGroups>
                  <neuronGroup name="Exc-Logistic" role="Excitatory" relShare="4" augmentedStates="true">
                    <activationSigmoid/>
                    <bias min="-1" max="1" randomSign="false" distribution="Uniform"/>
                  </neuronGroup>
                  <neuronGroup name="Inh-Logistic" role="Inhibitory" relShare="1" augmentedStates="true">
                    <activationSigmoid/>
                    <bias min="-1" max="1" randomSign="false" distribution="Uniform"/>
                  </neuronGroup>
                </neuronGroups>
                <interconnection density="0.1" relShareEE="0.3" relShareEI="0.2" relShareIE="0.4" relShareII="0.1" avgDistance="NA" allowSelfConnection="true" constantNumOfConnections="false">
                  <synapse/>
                </interconnection>
              </pool>
            </pools>
            <pool2PoolConns>
              <pool2PoolConn srcPool="Spiking pool" srcConnDensity="0.5" targetPool="Logistic pool" targetConnDensity="0.05" relShareEE="0.3" relShareEI="0.2" relShareIE="0.4" relShareII="0.1" constantNumOfConnections="false">
                <synapse/>
              </pool2PoolConn>
              <pool2PoolConn srcPool="Logistic pool" srcConnDensity="0.5" targetPool="Spiking pool" targetConnDensity="0.05" relShareEE="0.3" relShareEI="0.2" relShareIE="0.4" relShareII="0.1" constantNumOfConnections="false">
                <synapse/>
              </pool2PoolConn>
            </pool2PoolConns>
          </reservoirCfg>
        </reservoirCfgContainer>
        <reservoirInstanceContainer>
          <reservoirInstance name="Main" cfg="MainCfg" augmentedStates="false">
            <inputConnections>
              <inputConnection fieldName="EEG" poolName="Spiking pool" density="1">
                <synapse/>
              </inputConnection>
              <inputConnection fieldName="mg" poolName="Spiking pool" density="1">
                <synapse/>
              </inputConnection>
              <inputConnection fieldName="EEG" poolName="Logistic pool" density="1">
                <synapse/>
              </inputConnection>
              <inputConnection fieldName="mg" poolName="Logistic pool" density="1">
                <synapse>
                  <analogTarget>
                    <weight min="0.5" max="0.5" distribution="Uniform"/>
                  </analogTarget>
                </synapse>
              </inputConnection>
            </inputConnections>
          </reservoirInstance>
        </reservoirInstanceContainer>
      </neuralPreprocessor>
      <readoutLayer testDataRatio="0.1" folds="Auto">
        <readoutUnit name="EpilepticSeizure" task="Classification">
          <ff>
            <activationTanH/>
            <hiddenLayers>
              <layer neurons="20">
                <activationTanH/>
              </layer>
            </hiddenLayers>
            <resPropTrainer attempts="5" attemptEpochs="3000"/>
          </ff>
        </readoutUnit>
      </readoutLayer>
    </stateMachineCfg>
  </case>

</demo>
